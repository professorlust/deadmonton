!function(a){var b=function(a,c,d){var e=b.resolve(a);if(!e){d=d||a,c=c||"root";var f=new Error('Failed to require "'+d+'" from "'+c+'"');throw f.path=d,f.parent=c,f.require=!0,f}var g=b.modules[e];if(!g._resolving&&!g.exports){var h={};h.exports={},h.client=h.component=!0,g._resolving=!0,g.call(this,h.exports,b.relative(e),h),delete g._resolving,g.exports=h.exports}return g.exports};b.modules={},b.aliases={},b.resolve=function(a){"/"===a.charAt(0)&&(a=a.slice(1));for(var c=[a,a+".js",a+".json",a+"/index.js",a+"/index.json"],d=0;d<c.length;d++){if(a=c[d],b.modules.hasOwnProperty(a))return a;if(b.aliases.hasOwnProperty(a))return b.aliases[a]}},b.normalize=function(a,b){var c=[];if("."!=b.charAt(0))return b;a=a.split("/"),b=b.split("/");for(var d=0;d<b.length;++d)".."==b[d]?a.pop():"."!==b[d]&&""!==b[d]&&c.push(b[d]);return a.concat(c).join("/")},b.register=function(a,c){b.modules[a]=c},b.alias=function(a,c){if(!b.modules.hasOwnProperty(a))throw new Error('Failed to alias "'+a+'", it does not exist');b.aliases[c]=a},b.relative=function(a){function c(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}var d=b.normalize(a,".."),e=function(c){var d=e.resolve(c);return b(d,a,c)};return e.resolve=function(e){var f=e.charAt(0);if("/"==f)return e.slice(1);if("."==f)return b.normalize(d,e);var g=a.split("/"),h=c(g,"deps")+1;return h||(h=0),e=g.slice(0,h+1).join("/")+"/deps/"+e},e.exists=function(a){return b.modules.hasOwnProperty(e.resolve(a))},e},a.require="undefined"!=typeof a.require?a.require:b}(this),function(a){!function(){a.require.register("deadmonton/src/config.js",function(a,b,c){c.exports={categories:{"Theft From Vehicle":{rgb:[255,237,160],active:!0},"Theft Of Vehicle":{rgb:[254,217,118],active:!0},"Theft Over $5000":{rgb:[254,217,118],active:!0},"Break and Enter":{rgb:[253,141,60],active:!0},Robbery:{rgb:[253,141,60],active:!0},Assault:{rgb:[227,26,28],active:!0},"Sexual Assaults":{rgb:[227,26,28],active:!0},Homicide:{rgb:[0,0,0],active:!0}},window:{width:$(window).width(),height:$(window).height()},center:[53.5501,-113.5049]}}),a.require.register("deadmonton/src/templates/categories.js",function(a,b,c){c.exports=["{{ #category:name }}",'<li class="{{ #active }}active{{ /active }}" on-click="toggle">','    <span class="circle" style="background:rgb({{ rgb }})"></span> {{ name }}',"</li>","{{ /category }}"].join("\n")}),a.require.register("deadmonton/src/templates/controls.js",function(a,b,c){c.exports=["<span class=\"icon replay\" on-click='replay'></span>","<span class=\"icon play\" on-click='play'></span>","<span class=\"icon pause\" on-click='pause'></span>"].join("\n")}),a.require.register("deadmonton/src/templates/layout.js",function(a,b,c){c.exports=['<div id="map"></div>','<canvas id="canvas"></canvas>',"",'<div id="controls" class="box"></div>','<div id="date" class="box"></div>','<ul id="categories" class="box"></ul>',"",'<div id="loading" class="box">Loading &hellip;</div>'].join("\n")}),a.require.register("deadmonton/src/views/app.js",function(a,b,c){var d,e,f,g,h,i;i=b("./state"),h=b("./controls"),f=b("./canvas"),g=b("./categories"),d=Ractive.extend({template:b("../templates/layout"),init:function(){var a=this;return i.observe("ready",function(b){return b?$(a.el).find("#loading").hide():void 0}),f.render("#map"),h.render("#controls"),g.render("#categories")}}),c.exports=e=new d,$.get("crime.json.lzma",function(a){return LZMA.decompress(a.split(","),function(a){return f.set({crime:JSON.parse(a)}),i.set("ready",!0)})})}),a.require.register("deadmonton/src/views/canvas.js",function(a,b,c){var d,e,f,g;e=b("../config"),f=b("./controls"),g=b("./state"),d=Ractive.extend({init:function(){var a,b,c,d=this;return this.on("change",this.reset),g.observe("command",function(a,b){if(b)switch(a){case"pause":case"stop":return d.pause();case"play":return d.play();case"replay":return d.reset()}}),$(this.el).css("width",""+e.window.width+"px").css("height",""+e.window.height+"px"),c=e.center,a=c[0],b=c[1],this.map=new L.Map("map",{center:new L.LatLng(a,b),zoom:12,zoomControl:!1}),L.tileLayer.provider("Stamen.Toner").addTo(this.map),this.map.on("movestart",function(){return g.set("command","pause"),d.clear()}),this.map.on("moveend",function(){var a,b,c,e,f;if(d.particles.length){for(e=d.particles,f=[],b=0,c=e.length;c>b;b++)a=e[b],a.point=d.position(a.l),f.push(d.draw(a));return f}}),this.ctx=document.getElementById("canvas").getContext("2d"),this.ctx.globalCompositeOperation="darker",$("#canvas").attr("width",e.window.width).attr("height",e.window.height)},position:function(a){return this.map.layerPointToContainerPoint(this.map.latLngToLayerPoint(a))},clear:function(){return this.ctx.clearRect(0,0,e.window.width,e.window.height)},draw:function(a){var b,c,d,f;return c=a.point,f=a.ttl,c.x<0||c.y<0||!e.categories[a.c].active?void 0:(d=.1*f*this.map.getZoom(),b=this.ctx.createRadialGradient(c.x,c.y,0,c.x,c.y,d),b.addColorStop(0,"white"),b.addColorStop(.8,"rgba("+a.color+",0.5)"),b.addColorStop(1,"black"),this.ctx.beginPath(),this.ctx.fillStyle=b,this.ctx.arc(c.x,c.y,d,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill())},play:function(){var a,b=this;return a=$("#date"),this.i1=setInterval(function(){var c,d,f;if(b.now>b.end)return g.set("command","stop");for(a.html(b.now.format("ddd, Do MMMM YYYY")),c=b.get("crime"),d=!0;d&&b.index<c.length;)b.now>=new Date((f=c[b.index]).t)?(f.ttl=10,f.point=b.position(f.l),f.color=e.categories[f.c].rgb.join(","),b.particles.push(f),b.index+=1):d=!1;return b.now=b.now.add("d",1)},200),this.i2=setInterval(function(){var a,c,d,e,f;for(b.clear(),e=b.particles,f=[],c=0,d=e.length;d>c;c++)a=e[c],b.draw(a),f.push(a.ttl>3?a.ttl-=.1:void 0);return f},33)},pause:function(){return _.each([this.i1,this.i2],clearInterval),this.clear(),_.each(this.particles,this.draw,this)},reset:function(){var a;return this.pause(),a=this.get("crime"),this.now=moment(new Date(a[0].t)),this.end=moment(new Date(a[a.length-1].t)),this.particles=[],this.index=0}}),c.exports=new d}),a.require.register("deadmonton/src/views/categories.js",function(a,b,c){var d,e,f;e=b("../config"),f=b("./state"),d=Ractive.extend({template:b("../templates/categories"),init:function(){return this.on("toggle",function(a){return this.set(""+a.keypath+".active",!a.context.active),f.set("command","pause")})},data:{category:e.categories}}),c.exports=new d}),a.require.register("deadmonton/src/views/controls.js",function(a,b,c){var d,e,f;e=b("./canvas"),f=b("./state"),d=Ractive.extend({template:b("../templates/controls"),init:function(){var a=this;return this.on("play",this.onPlay),this.on("pause",this.onPlay),this.on("replay",this.onReplay),f.observe("ready",function(b){return b?a.onReady():void 0}),f.observe("command",function(b,c){if(c)switch(b){case"stop":return a.onStop();case"pause":return a.onPause()}})},onPlay:function(){return $(this.el).find(".play, .pause").toggleClass("active"),$(this.el).find(".replay").addClass("active"),f.set("command",["play","pause"][+f.get("playing")])},onReplay:function(){return $(this.el).find(".play").removeClass("active"),$(this.el).find(".pause").addClass("active"),f.set("command","replay"),f.set("command","play")},onReady:function(){return $(this.el).find(".icon.play").addClass("active")},onStop:function(){return $(this.el).find(".icon.play, .icon.pause").removeClass("active"),$(this.el).find(".icon.replay").addClass("active")},onPause:function(){return $(this.el).find(".icon.play").addClass("active"),$(this.el).find(".icon.pause").removeClass("active")}}),c.exports=new d}),a.require.register("deadmonton/src/views/state.js",function(a,b,c){var d;c.exports=d=new Ractive({data:{command:"stop",playing:!1,ready:!1}}),d.observe("command",function(a){return this.set("playing","play"===a),"pause"===a?this.set("command","n/a"):void 0})})}();var b=a.require("deadmonton/src/views/app.js");"undefined"!=typeof define&&define.amd?define("deadmonton",[],function(){return b}):"undefined"!=typeof module&&module.exports?module.exports=b:a.deadmonton=b,a.require.alias("deadmonton/src/views/app.js","deadmonton/index.js")}(this);