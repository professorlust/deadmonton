!function(){function a(b,c,d){var e=a.resolve(b);if(null==e){d=d||b,c=c||"root";var f=new Error('Failed to require "'+d+'" from "'+c+'"');throw f.path=d,f.parent=c,f.require=!0,f}var g=a.modules[e];if(!g._resolving&&!g.exports){var h={};h.exports={},h.client=h.component=!0,g._resolving=!0,g.call(this,h.exports,a.relative(e),h),delete g._resolving,g.exports=h.exports}return g.exports}a.modules={},a.aliases={},a.resolve=function(b){"/"===b.charAt(0)&&(b=b.slice(1));for(var c=[b,b+".js",b+".json",b+"/index.js",b+"/index.json"],d=0;d<c.length;d++){var b=c[d];if(a.modules.hasOwnProperty(b))return b;if(a.aliases.hasOwnProperty(b))return a.aliases[b]}},a.normalize=function(a,b){var c=[];if("."!=b.charAt(0))return b;a=a.split("/"),b=b.split("/");for(var d=0;d<b.length;++d)".."==b[d]?a.pop():"."!=b[d]&&""!=b[d]&&c.push(b[d]);return a.concat(c).join("/")},a.register=function(b,c){a.modules[b]=c},a.alias=function(b,c){if(!a.modules.hasOwnProperty(b))throw new Error('Failed to alias "'+b+'", it does not exist');a.aliases[c]=b},a.relative=function(b){function c(a,b){for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function d(c){var e=d.resolve(c);return a(e,b,c)}var e=a.normalize(b,"..");return d.resolve=function(d){var f=d.charAt(0);if("/"==f)return d.slice(1);if("."==f)return a.normalize(e,d);var g=b.split("/"),h=c(g,"deps")+1;return h||(h=0),d=g.slice(0,h+1).join("/")+"/deps/"+d},d.exists=function(b){return a.modules.hasOwnProperty(d.resolve(b))},d},function(){a.register("deadmonton/src/app.js",function(a,b,c){var d;d=b("./views/layout"),c.exports=function(){return(new d).render()}}),a.register("deadmonton/src/config.js",function(a,b,c){c.exports={categories:{"Theft From Vehicle":{rgb:[255,237,160],active:!0},"Theft Of Vehicle":{rgb:[254,217,118],active:!0},"Theft Over $5000":{rgb:[254,217,118],active:!0},"Break and Enter":{rgb:[253,141,60],active:!0},Robbery:{rgb:[253,141,60],active:!0},Assault:{rgb:[227,26,28],active:!0},"Sexual Assaults":{rgb:[227,26,28],active:!0},Homicide:{rgb:[0,0,0],active:!0}},window:{width:$(window).width(),height:$(window).height()}}}),a.register("deadmonton/src/modules/mediator.js",function(a,b,c){c.exports=_.extend({},Backbone.Events)}),a.register("deadmonton/src/templates/category.js",function(a,b,c){c.exports=function(a){a||(a={});var b,c=[],d=function(a){return a&&a.ecoSafe?a:"undefined"!=typeof a&&null!=a?f(a):""},e=a.safe,f=a.escape;return b=a.safe=function(a){if(a&&a.ecoSafe)return a;("undefined"==typeof a||null==a)&&(a="");var b=new String(a);return b.ecoSafe=!0,b},f||(f=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){c.push('<li data-category="'),c.push(d(this.name)),c.push('" class="'),this.active&&c.push("active"),c.push('">\n    <span class="circle" style="background:rgb('),c.push(d(this.rgb)),c.push(')"></span> '),c.push(d(this.name)),c.push("\n</li>")}).call(this)}.call(a),a.safe=e,a.escape=f,c.join("")}}),a.register("deadmonton/src/templates/controls.js",function(a,b,c){c.exports=function(a){a||(a={});var b,c=[],d=a.safe,e=a.escape;return b=a.safe=function(a){if(a&&a.ecoSafe)return a;("undefined"==typeof a||null==a)&&(a="");var b=new String(a);return b.ecoSafe=!0,b},e||(e=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){c.push('<span class="icon replay"></span>\n<span class="icon play"></span>\n<span class="icon pause"></span>')}).call(this)}.call(a),a.safe=d,a.escape=e,c.join("")}}),a.register("deadmonton/src/templates/layout.js",function(a,b,c){c.exports=function(a){a||(a={});var b,c=[],d=a.safe,e=a.escape;return b=a.safe=function(a){if(a&&a.ecoSafe)return a;("undefined"==typeof a||null==a)&&(a="");var b=new String(a);return b.ecoSafe=!0,b},e||(e=a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){c.push('<div id="map"></div>\n<canvas id="canvas"></canvas>\n<div id="controls" class="box"></div>\n<div id="date" class="box"></div>\n<ul id="categories" class="box"></ul>\n<div id="loading" class="box">Loading &hellip;</div>')}).call(this)}.call(a),a.safe=d,a.escape=e,c.join("")}}),a.register("deadmonton/src/views/canvas.js",function(a,b,c){var d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=b("../config"),f=b("../modules/mediator"),d=function(a){function b(){this.draw=g(this.draw,this);var a;b.__super__.constructor.apply(this,arguments),this.reset(),a=document.getElementById("canvas"),this.ctx=a.getContext("2d"),$("#canvas").attr("width",e.window.width).attr("height",e.window.height),f.on("play",this.play,this),f.on("pause",this.pause,this),f.on("replay",this.reset,this),f.on("redraw",this.redraw,this)}return i(b,a),b.prototype.el="#map",b.prototype.render=function(){var a=this;return $(this.el).css("width",""+e.window.width+"px").css("height",""+e.window.height+"px"),this.map=new L.Map("map",{center:new L.LatLng(53.5501,-113.5049),zoom:12,zoomControl:!1}),this.map.on("movestart",function(){return f.trigger("pause"),a.frame(!0)}),this.map.on("moveend",function(){var b,c,d,e,f;if(a.particles.length){for(e=a.particles,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.point=a.position(b.l),f.push(a.draw(b));return f}}),L.tileLayer.provider("Stamen.Toner").addTo(this.map)},b.prototype.position=function(a){return this.map.layerPointToContainerPoint(this.map.latLngToLayerPoint(a))},b.prototype.frame=function(a){var b;return null==a&&(a=!1),b=["source-out","copy"][+a],this.ctx.globalCompositeOperation=b,this.ctx.fillStyle="rgba(0,0,0,0.1)",this.ctx.fillRect(0,0,e.window.width,e.window.height),this.ctx.globalCompositeOperation="darker"},b.prototype.draw=function(a){var b,c,d;return c=a.point,d=a.ttl,c.x<0||c.y<0||!e.categories[a.c].active?void 0:(b=this.ctx.createRadialGradient(c.x,c.y,0,c.x,c.y,d),b.addColorStop(0,"white"),b.addColorStop(.8,"rgba("+a.color+",0.5)"),b.addColorStop(1,"black"),this.ctx.beginPath(),this.ctx.fillStyle=b,this.ctx.arc(c.x,c.y,d,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill())},b.prototype.play=function(){var a,b=this;return this.playing=!0,a=$("#date"),this.i1=setInterval(function(){var c,d;if(b.now>b.end)return b.stop();for(a.html(b.now.format("ddd, Do MMMM YYYY")),c=!0;c&&b.index<b.collection.length;)b.now>=new Date((d=b.collection[b.index]).t)?(d.ttl=10,d.point=b.position(d.l),d.color=e.categories[d.c].rgb.join(","),b.particles.push(d),b.index+=1):c=!1;return b.now=b.now.add("d",1)},200),this.i2=setInterval(function(){var a,c,d,e,f;for(b.frame(),e=b.particles,f=[],c=0,d=e.length;d>c;c++)a=e[c],b.draw(a),a.ttl>3?f.push(a.ttl-=.1):f.push(void 0);return f},33)},b.prototype.pause=function(){return this.playing=!1,_.each([this.i1,this.i2],clearInterval)},b.prototype.stop=function(){return this.pause(),this.playing=!1,f.trigger("stop")},b.prototype.reset=function(){return this.pause(),this.now=moment(new Date(this.collection[0].t)),this.end=moment(new Date(this.collection[this.collection.length-1].t)),this.particles=[],this.index=0,this.playing=!1},b.prototype.redraw=function(){return this.playing?void 0:(this.frame(!0),_.each(this.particles,this.draw))},b}(Backbone.View),c.exports=d}),a.register("deadmonton/src/views/categories.js",function(a,b,c){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};f=b("../modules/mediator"),e=b("../config"),d=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return h(c,a),c.prototype.el="#categories",c.prototype.template=b("../templates/category"),c.prototype.events={"click li":"onToggle"},c.prototype.render=function(){var a,b,c;c=e.categories;for(b in c)a=c[b],$(this.el).append(this.template(_.extend(a,{name:b})));return this},c.prototype.onToggle=function(a){var b,c;return c=e.categories[(b=$(a.target)).data("category")],c.active=!c.active,b.toggleClass("active"),f.trigger("redraw")},c}(Backbone.View),c.exports=d}),a.register("deadmonton/src/views/controls.js",function(a,b,c){var d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=b("../modules/mediator"),d=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.playing=!1,e.on("loaded",function(){return $(this.el).find(".icon.play").addClass("active")},this),e.on("stop",function(){return this.playing=!1,$(this.el).find(".icon.play").removeClass("active"),$(this.el).find(".icon.pause").removeClass("active"),$(this.el).find(".icon.replay").addClass("active")},this),e.on("pause",function(){return this.playing?(this.playing=!1,$(this.el).find(".icon.play").addClass("active"),$(this.el).find(".icon.pause").removeClass("active")):void 0},this)}return g(c,a),c.prototype.el="#controls",c.prototype.template=b("../templates/controls"),c.prototype.events={"click .icon.play":"onPlay","click .icon.pause":"onPlay","click .icon.replay":"onReplay"},c.prototype.onPlay=function(a){return $(a.target).hasClass("active")?($(this.el).find(".play, .pause").toggleClass("active"),this.playing=!this.playing,e.trigger(["pause","play"][+this.playing]),$(this.el).find(".replay").addClass("active")):void 0},c.prototype.onReplay=function(a){var b;if((b=$(a.target)).hasClass("active"))return this.playing=!0,$(this.el).find(".play").removeClass("active"),$(this.el).find(".pause").addClass("active"),e.trigger("replay"),e.trigger("play")},c.prototype.render=function(){return $(this.el).html(this.template()),this},c}(Backbone.View),c.exports=d}),a.register("deadmonton/src/views/layout.js",function(a,b,c){var d,e,f,g,h,i={}.hasOwnProperty,j=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};h=b("../modules/mediator"),f=b("./controls"),e=b("./categories"),d=b("./canvas"),g=function(a){function c(){c.__super__.constructor.apply(this,arguments),this.views=[],h.on("loaded",function(){return $(this.el).find("#loading").hide()},this),$.getJSON("data/crime.json",function(a){return new d({collection:a}).render(),h.trigger("loaded")})}return j(c,a),c.prototype.el="body",c.prototype.template=b("../templates/layout"),c.prototype.render=function(){return $(this.el).html(this.template()),(new f).render(),(new e).render(),this},c}(Backbone.View),c.exports=g})}();var b=a("deadmonton/src/app.js"),c=this;"undefined"!=typeof define&&define.amd?define("deadmonton",[],function(){return b}):"undefined"!=typeof module&&module.exports?module.exports=b:c.deadmonton=b,a.alias("deadmonton/src/app.js","deadmonton/index.js"),c.require="undefined"!=typeof c.require?c.require:a}();